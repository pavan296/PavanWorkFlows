name: Daily README Update (Reusable)

on:
  workflow_call:
    inputs:
      timezone:
        description: 'Timezone for date display (e.g., Asia/Dubai)'
        required: false
        type: string
        default: 'UTC'
    secrets:
      token:
        description: 'GitHub token for committing'
        required: false

jobs:
  update-readme:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.token || secrets.GITHUB_TOKEN }}
      
      - name: Update README
        env:
          TZ: ${{ inputs.timezone }}
        run: |
          # Fetch a random quote
          QUOTE_DATA=$(curl -s https://api.quotable.io/random)
          QUOTE=$(echo $QUOTE_DATA | grep -o '"content":"[^"]*"' | cut -d'"' -f4)
          AUTHOR=$(echo $QUOTE_DATA | grep -o '"author":"[^"]*"' | cut -d'"' -f4)
          
          # Fallback if API fails
          if [ -z "$QUOTE" ]; then
            QUOTE="The only way to do great work is to love what you do."
            AUTHOR="Steve Jobs"
          fi
          
          # Get current date and time
          CURRENT_DATE=$(date '+%B %d, %Y')
          CURRENT_TIME=$(date '+%I:%M %p')
          
          # Create README content
          cat > README.md << EOF
          # Daily Updates Repository
          
          ## ðŸ“… Last Updated: ${CURRENT_DATE}
          
          ## ðŸ’­ Quote of the Day
          
          > "${QUOTE}"
          > 
          > â€” **${AUTHOR}**
          
          ---
          
          ### About This Repository
          
          This repository is automatically updated daily with inspirational quotes and timestamps.
          
          **Auto-update Status:** âœ… Active  
          **Last Run:** ${CURRENT_DATE} at ${CURRENT_TIME}
          EOF
          
          echo "README updated successfully!"
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ“… Daily update: $(date '+%Y-%m-%d')" && git push)